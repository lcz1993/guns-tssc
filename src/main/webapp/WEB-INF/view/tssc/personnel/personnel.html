<html class="header-pc lang-ch">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,requiresActiveX=true" />
    <title>关于我们</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no" />
    <meta name="google" value="notranslate" />
    <meta http-equiv="cleartype" content="on" />

    <!-- Page info metas start-->
    <meta name="description" content="">
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <meta property="og:site_name" content="">
    <meta property="og:type" content="website">
    <meta property="article:publisher" content="">
    <meta property="article:author" content="">
    <!-- Page info metas end-->

    <link rel="shortcut icon" href="${ctxPath}/static/reception/img/logo.png"/>
    <!-- Initial header classname -->
    <script>!!(window.innerWidth <= 960) && (document.documentElement.className = document.documentElement.className.replace('header-pc', 'header-mb'));</script>
    <link rel="stylesheet" href="${ctxPath}/static/reception/css/indexom.css" />
    <link rel="stylesheet" href="${ctxPath}/static/reception/css/main.css" />
    <!-- 全局css -->
    <link rel="shortcut icon" href="${ctxPath}/static/favicon.ico">
    <link href="${ctxPath}/static/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="${ctxPath}/static/css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="${ctxPath}/static/css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
    <link href="${ctxPath}/static/css/plugins/validate/bootstrapValidator.min.css" rel="stylesheet">
    <link href="${ctxPath}/static/css/animate.css" rel="stylesheet">
    <link href="${ctxPath}/static/css/style.css?v=4.1.0" rel="stylesheet">
    <link href="${ctxPath}/static/css/_fstyle.css" rel="stylesheet">
    <link href="${ctxPath}/static/css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="${ctxPath}/static/css/plugins/webuploader/webuploader.css" rel="stylesheet">
    <link href="${ctxPath}/static/css/plugins/ztree/zTreeStyle.css" rel="stylesheet">
    <link href="${ctxPath}/static/css/plugins/jquery-treegrid/css/jquery.treegrid.css" rel="stylesheet"/>
    <!-- 全局js -->
    <script src="${ctxPath}/static/js/jquery.min.js?v=2.1.4"></script>
    <script src="${ctxPath}/static/js/bootstrap.min.js?v=3.3.6"></script>
    <script src="${ctxPath}/static/js/plugins/ztree/jquery.ztree.all.min.js"></script>
    <script src="${ctxPath}/static/js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="${ctxPath}/static/js/plugins/validate/bootstrapValidator.min.js"></script>
    <script src="${ctxPath}/static/js/plugins/validate/zh_CN.js"></script>
    <script src="${ctxPath}/static/js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script>
    <script src="${ctxPath}/static/js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
    <script src="${ctxPath}/static/js/plugins/jquery-treegrid/js/jquery.treegrid.min.js"></script>
    <script src="${ctxPath}/static/js/plugins/jquery-treegrid/js/jquery.treegrid.bootstrap3.js"></script>
    <script src="${ctxPath}/static/js/plugins/jquery-treegrid/extension/jquery.treegrid.extension.js"></script>
    <script src="${ctxPath}/static/js/plugins/layer/layer.min.js"></script>
    <script src="${ctxPath}/static/js/plugins/iCheck/icheck.min.js"></script>
    <script src="${ctxPath}/static/js/plugins/layer/laydate/laydate.js"></script>
    <script src="${ctxPath}/static/js/plugins/webuploader/webuploader.min.js"></script>
    <script src="${ctxPath}/static/js/common/ajax-object.js"></script>
    <script src="${ctxPath}/static/js/common/bootstrap-table-object.js"></script>
    <script src="${ctxPath}/static/js/common/tree-table-object.js"></script>
    <script src="${ctxPath}/static/js/common/web-upload-object.js"></script>
    <script src="${ctxPath}/static/js/common/ztree-object.js"></script>
    <script src="${ctxPath}/static/js/common/Feng.js"></script>

    <script type="text/javascript">
        Feng.addCtx("${ctxPath}");
        Feng.sessionTimeoutRegistry();
    </script>
</head>
<body ontouchstart="" style="background-color: #AAA">
<!--/.masthead-->
<main class="mastbody">
    <div class="mastbody-inner">
        <div class="effect-holder" data-effect="about"></div>
        <!--************************
                   #/about-leader
               ************************-->
        <div data-section="about-leader" class="section">
            <section data-mainpage="list" class="mainpage">
                <div class="page-body about-leader">
                    <div class="row-main">
                        <input type="hidden" value="" id="company_id">
                        <div class="header" id="personnel_com">
                            <h1 class="maintitle" >腾盛时创团队</h1><a onclick="editComPersonnel()">编辑</a>
                        </div>
                        <div class="content">
                            <div class="content-inner">
                                <a onclick="Personnel.openAddPersonnel()" >
                                    <i class="fa"></i>&nbsp;添加员工
                                </a>
                                <ul class="list" id="personnel_ul">
                                    <!--员工名称职位-->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section data-mainpage="detail" class="mainpage" id="personnel_section">
                <!--职工详细信息-->
                <div class="redstripe"></div>
            </section>
        </div>
        <!--/[data-section]-->
    </div>
    <!--/.mastbody-inner-->
</main>

<div id="navDots" class="navdots">
    <div class="outer">
        <div class="inner">
            <a class="dot" href="${ctxPath}/studio"><b></b></a>
            <a class="dot" href="${ctxPath}/personnel"><b></b></a>
            <a class="dot" href="${ctxPath}/field"><b></b></a>
            <a class="dot" href="${ctxPath}/company/brand"><b></b></a>
            <a class="dot" href="${ctxPath}/company/history"><b></b></a>
            <a class="dot" href="${ctxPath}/company/social"><b></b></a>
        </div>
    </div>
</div>
<!--/.navdots-->
<script src="${ctxPath}/static/modular/tssc/personnel/personnel_info.js"></script>
<script src="${ctxPath}/static/modular/tssc/personnel/personnel.js"></script>
<script src="${ctxPath}/static/reception/jquery/jquery-3.3.1.min.js"></script>
<script src="${ctxPath}/static/reception/js/libs/plugins.js"></script>
<script src="${ctxPath}/static/reception/js/main.js"></script>
<script>
    $(function () {
        companyPersonnelInit();
        personnelInit();
    });

    /**
     * 图片上传保存
     */
    function sumbitImgPer(event) {
        var h = $(event.target).parents(".form-group");
        var first = h.children().first();
        var id = first.val();
        var imgInput = h.children("#"+id+"image");
        var src = imgInput.val();
        $.ajax({
            url:"${ctxPath}/personnel/update",
            type:"post",
            data:{param:"id="+id+"&image="+src},
            dataType:"json",
            success:function (result) {
                Feng.alert("提交成功", 1);
            },
            fail:function () {
                Feng.alert("提交失败", 1);
            }
        });
    }
    /**
     * 修改名称
     */
    function editNamePre(event) {
        var btn = $(event.target);
        var h2 = btn.prev();
        var name = h2.text();
        var reg = /[\u4e00-\u9fa5]/g;
        name = name.match(reg).join("");
        var engName = h2.children("span").text();
        var input = h2.children("input");
        var id = input.val();
        var div = h2.parent();
        var i = "";
        i += '<div class="input-group">';
        i += '<input type="hidden" id="pre_id" class="form-control" value="'+id+'"/>';
        i += '<input type="text" id="pre_name" class="form-control" value="'+name+'"/>';
        i += '<input type="text" id="pre_engName" class="form-control" value="'+engName+'"/>';
        i += '<span class="input-group-btn">';
        i += '<button type="button" class="btn btn-primary" onclick="updateNamePre(event)">提交</button>';
        i += '</span>';
        i += '</div>';
        var $i = $(i);
        h2.remove();
        btn.remove();
        div.append($i);
    }
    /**
     * 修改名称保存
     */
    function updateNamePre(event) {
        var btn = $(event.target);
        var span = btn.parent();
        var div = span.parent();
        var id = div.children("#pre_id").val();
        var name = div.children("#pre_name").val();
        var engName = div.children("#pre_engName").val();
        $.ajax({
            url:"${ctxPath}/personnel/update",
            type:"post",
            data:{param:"id="+id+"&name="+name+"&engName="+engName},
            dataType:"json",
            success:function (result) {
                result = result.data;
                div.empty();
                var i = "";
                i += '<h2 class="maintitle clr-red"><input type="hidden" value="'+id+'">' + name;
                i += '<span class="en">' + engName + '</span></h2>';
                i += '<a onclick="editNamePre(event)">编辑</a>';
                var $i = $(i);
                div.append($i);
                Feng.success("提交成功！");
            },
            fali:function () {
                Feng.error("提交失败！");
            }
        });
    }
    /**
     * 介绍编辑
     */
    function introducePreEdit(event) {
        var btn = $(event.target);
        var p = btn.parent();
        p.text("");
        var input = "";
        input += '<textarea class="form-control" rows="3"></textarea>';
        input += '<button type="button" class="btn btn-info" style="width: 66.188px;height: 28px;float: right;" onclick="updatePreIntroduce(event);">提交</button>';
        var $input = $(input);
        p.append($input);
    }
    /**
     * 介绍提交
     */
    function updatePreIntroduce(event) {
        var btn = $(event.target);
        var textarea = btn.prev();
        var introduce = textarea.val();
        var first = textarea.parent().parent().children("input");
        var id = first.val();
        $.ajax({
            url:"${ctxPath}/personnel/update",
            type:"post",
            data:{param:"id="+id+"&introduce="+introduce},
            dataType:"json",
            success:function (result) {
                result = result.data;
                Feng.alert("提交成功", 1);
                var span = btn.parent();
                textarea.remove();
                btn.remove();
                span.text(result.introduce);
                var i = "";
                i += '<p>'+introduce+'</p>';
                i += '<button type="button" class="btn btn-info" style="height: 28px;float: right;" onclick="introduceStudioEdit(event);">编辑介绍</button>';
                var $i = $(i);
                span.append($i);
            },
            fail:function () {
                Feng.alert("提交失败", 1);
            }
        });
    }
    /**
     * 初始化团队成员
     */
    function personnelInit() {
        $.ajax({
            url:"${ctxPath}/personnel/list",
            type:"get",
            data:"",
            dataType:"json",
            success :function (result) {
                result = result.data;
                for(var re in result) {
                    var id = result[re].id;
                    var name = result[re].name;
                    var engName = result[re].engName;
                    var position = result[re].position;
                    var introduce = result[re].introduce;
                    var image = result[re].image;
                    var li = '';
                    li += '<li class="item"><a class="name ff-loud" data-ga-event="about-leader-' +
                        id + '" href="#/about-leader/'+id+'">' + name + '<i class="icn icn-inline icn-angle-right"></i></a>';
                    li += '<ul class="titles">';
                    var positions = position.split(";");
                    for (var p in positions) {
                        li += '<li>' + positions[p] + '</li>';
                    }
                    li += '</ul> </li>';
                    var $li = $(li);
                    $("#personnel_ul").append($li);

                    var section = '';
                    section += '<section data-subpage="' + id + '" class="subpage">';
                    section += '<div class="page-body about-leader-detail">';

                    section += '<div class="row-side">';
                    section += '<div class="content" data-autosize="">';
                    section += '<div class="content-mask">';
                    section += '<div class="content-outer">';
                    section += '<div class="content-inner">';
                    section += '<div class="form-group">';
                    section += '<input type="hidden" value="'+id+'">';
                    section += '<div class="col-sm-12" style="position: absolute;bottom: 170px;">';
                    section += '<div id="'+id+'imagePreId">';
                    section += '<div><img class="pic" data-centered="" style="margin-top: 0;margin-left: 0" src="${ctxPath}/personnel/' + image + '" />';
                    section += '</div>';
                    section += '</div>';
                    section += '<div class="" style="float: right;">';
                    section += '<button type="button" class="btn btn-info" style="width: 66.188px;height: 32px;margin-right: 5px;" onclick="sumbitImgPer(event);">提交</button>';
                    section += '<div class="upload-btn " id="'+id+'imageBtnId"  style="float: right;">';
                    section += '<i></i>&nbsp;上传';
                    section += '</div>';
                    section += '</div>';
                    section += '</div>';
                    section += '<input type="hidden" id="'+id+'image" value="'+image+'"/>';
                    section += '</div>';
                    section += '</div>';
                    section += '</div>';
                    section += '</div>';
                    section += '</div>';
                    section += '</div>';

                    section += '<div class="row-main">';
                    section += '<div class="header">';
                    section += '<h2 class="maintitle clr-red"><input type="hidden" value="'+id+'">' + name;
                    section += '<span class="en">' + engName + '</span></h2>';
                    section += '<a onclick="editNamePre(event)">编辑</a>';
                    section += '</div>';
                    section += '<div class="content" data-scrollpane="" data-autosize="">';
                    section += '<div class="content-inner">';

                    section += '<a onclick="addPosition(event)">添加职位</a><input type="hidden" value="'+id+'"/>';
                    section += '<ul class="titles" id="positions_ul'+id+'">';

                    for (var p in positions) {
                        section += '<li><span>' + positions[p] + '</span><a class="" title="编辑"><i class="icn icn-circle-thin" onclick="updatePosition(event);"></i></a>';
                        section += '<a class="" title="删除" onclick="deletePosition(event);"><i class="icn icn-close"></i></a></li>';
                    }

                    section += '</ul>';
                    section += '<div class="descr htmledit">';
                    section += '<input type="hidden" value="'+id+'"/>';
                    section += '<p>' + introduce + '<button type="button" class="btn btn-info" style="height: 28px;float: right;" onclick="introducePreEdit(event);">编辑介绍</button></p>';

                    section += '</div>';
                    section += '</div>';
                    section += '</div>';
                    section += '<a class="btn-close back" href="#/about-leader" title="回前頁"><i class="icn icn-close"></i></a>';
                    section += '</div>';
                    section += '</div>';
                    section += '</section>';

                    var $section = $(section);
                    $("#personnel_section").append($section);
                    var url = '/personnel/upload'
                    var image = new $WebUpload(id+"image",url,true,500);
                    image.init();
                }
                Feng.success("加载成功！");
            },
            fail:function () {
                Feng.error("加载失败！");
            }
        });
    }
    /**
     * 添加UL
     */
    function addPosition(event) {
        var btn = $(event.target);
        var id = btn.next().val();
        var ul = $("#positions_ul"+id);
        var li = "";
        li += '<li>';
        li += '<div class="input-group">';
        li += '<input type="text" class="form-control" placeholder="请输入职位"/>';
        li += '<span class="input-group-btn">';
        li += '<button type="button" class="btn btn-primary" onclick="submitPosition(event)">提交</button>';
        li += '</span>';
        li += '</div>';
        li += '</li>';
        var $li = $(li);
        ul.append($li);
    }
    /**
     * 删除职位
     */
    function deletePosition(event) {
        layer.confirm("确认删除？",function () {
            var btn = $(event.target);
            var li = btn.parent().parent();
            var id = li.parent().prev().val();
            li.remove();
            var lis = $("#positions_ul"+id).children("li");
            var position = "";
            for(var i=0;i<lis.length;i++){
                position += $(lis[i]).children("span").text();
                position += ";";
            }
            position = position.substr(0,position.length-1);
            $.ajax({
                url:"${ctxPath}/personnel/update",
                data:{param:"id="+id+"&position="+position},
                dataType:"json",
                type:"post",
                success:function (result) {
                    Feng.success("提交成功！");
                },
                fail:function () {
                    Feng.success("提交失败！");
                }
            });
        });
    }
    /**
     * 编辑职位
     */
    function updatePosition(event) {
        var btn = $(event.target);
        var li = btn.parent().parent();
        var position = li.children("span").text();
        li.empty();
        var input = "";
        input += '<div class="input-group">';
        input += '<input type="text" class="form-control" value="'+position+'"/>';
        input += '<span class="input-group-btn">';
        input += '<button type="button" class="btn btn-primary" onclick="submitPosition(event)">提交</button>';
        input += '</span>';
        input += '</div>';
        var $input = $(input);
        li.append($input);
    }
    /**
     * 提交职位修改
     */
    function submitPosition(event) {
        var btn = $(event.target);
        var ul = btn.parents(".input-group").parent().parent();
        var lis = ul.children("li");
        var id = ul.prev().val();
        var position = "";
        for(var i = 0;i<lis.length;i++){
            var $li = $(lis[i]);
            var con = $li.children("span").text();
            if(typeof(con) != "undefined"){
                position += $li.children("span").text();
            }
            var c = $li.children(".input-group").children("input").val();
            if(typeof(c) != "undefined"){
                position += $li.children(".input-group").children("input").val();
            }
            position += ";";
        }
        position = position.substr(0,position.length-1);
        $.ajax({
            url:"${ctxPath}/personnel/update",
            data:{param:"id="+id+"&position="+position},
            dataType:"json",
            type:"post",
            success:function (result) {
                $("#positions_ul"+id).empty();
                var positions = position.split(";");
                var section = "";
                for (var p in positions) {
                    section += '<li><span>' + positions[p] + '</span><a class="" title="编辑"><i class="icn icn-circle-thin" onclick="updatePosition(event);"></i></a>';
                    section += '<a class="" title="删除" onclick="deletePosition(event);"><i class="icn icn-close"></i></a></li>';
                }
                var $section = $(section);
                ul.append($section);
                Feng.success("提交成功！");
            },
            fail:function () {
                Feng.success("提交失败！");
            }
        });


    }

    /**
     * 公司人员名称初始化
     */
    function companyPersonnelInit(){
        $.ajax({
            url:"${ctxPath}/company/get",
            type:"get",
            data:"",
            dataType:"json",
            success :function (result) {
                result = result.data;
                var id = result.id;
                $("#company_id").text(id);
                var personnel = result.personnel;
                $("#personnel_com h1").text(personnel);
            },
            fail:function () {
                $("#personnel_com h1").text("团队");
                Feng.error("加载失败");
            }
        });
    }

    /**
     *团队名称编辑
     */
    function editComPersonnel() {
        $("#personnel_com h1").remove();
        $("#personnel_com a").remove();
        var input = "";
        input += '<div class="input-group">';
        input += '<input type="text" class="form-control"/>';
        input += '<span class="input-group-btn">';
        input += '<button type="button" class="btn btn-primary" onclick="updateComPersonnel()">提交</button>';
        input += '</span>';
        input += '</div>';
        var $input = $(input);
        $("#personnel_com").append($input);
    }

    /**
     * 团队名称编辑提交
     */
    function updateComPersonnel() {
        var id = $("#company_id").text();
        var name = $("#personnel_com input").val();
        $.ajax({
            url:"${ctxPath}/company/update",
            type:"post",
            data:{param:"personnel="+name+"&id="+id},
            dataType:"json",
            success :function (result) {
                result = result.data;
                var id = result.id;
                var name = result.name;
                $("#company_id").text(id);
                //删除输入框,改为h1
                $("#personnel_com .input-group").remove();
                var input = "";
                input += '<h1 class="maintitle">'+name+'</h1>';
                input += '<a onclick="editComPersonnel()">编辑</a>';
                var $input = $(input);
                $("#personnel_com").append($input);
                window.location.reload();
                Feng.success("提交成功");
            },
            fail:function () {
                Feng.error("提交失败！");
            }
        });
    }
</script>
</body>
</html>
